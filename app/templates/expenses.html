{% extends "index.html" %}
{% block title %} - FinData{% endblock %}
{% block content %}

<div class="container mt-4">
  <h2 class="mb-4 text-center">Gestión de Gastos</h2>

  <!-- Formulario para añadir gasto -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <h5 class="card-title">Añadir nuevo gasto</h5>
      <form method="POST">
        {{ form.hidden_tag() }}

        <div class="mb-3">
          {{ form.date.label(class="form-label") }}
          {{ form.date(class="form-control") }}
        </div>

        <div class="mb-3">
          {{ form.amount.label(class="form-label") }}
          {{ form.amount(class="form-control", placeholder="Introduce el importe del gasto") }}
        </div>

        <div class="mb-3">
          {{ form.category.label(class="form-label") }}
          {{ form.category(class="form-select") }}
        </div>

        <div class="mb-3">
          {{ form.description.label(class="form-label") }}
          {{ form.description(class="form-control", rows="2", placeholder="Descripción opcional") }}
        </div>

        <button type="submit" class="btn btn-danger w-100">Añadir Gasto</button>
      </form>
    </div>
  </div>

  <!-- Tabla de historial de gastos -->
  <h4 class="mb-3">Historial de Gastos</h4>
  <div class="table-responsive">
    <table class="table table-striped table-hover">
      <thead class="table-danger">
        <tr>
          <th>Fecha</th>
          <th>Categoría</th>
          <th>Cantidad (€)</th>
          <th>Descripción</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for t in expenses %}
        <tr>
            <td>{{ t.date.strftime('%d/%m/%Y') }}</td>
            <td>{{ t.category or '-' }}</td>
            <td>{{ "%.2f"|format(t.amount) }}</td>
            <td>{{ t.description or '-' }}</td>
            <td>
                <form method="POST" action="{{ url_for('delete_transaction', transaction_id=t.id) }}" style="display: inline;" onsubmit="return confirm('¿Estás seguro de eliminar esta transacción?');">
                    <button type="submit" class="btn btn-danger btn-sm">
                        <i class="fas fa-trash"></i>
                    </button>
                </form>
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="5" class="text-center text-muted">No hay gastos registrados todavía.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}
